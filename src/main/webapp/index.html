<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="google-signin-client_id"
	content="276167503151-u1k7lgvd642u650dm3pflql6qj6ok049.apps.googleusercontent.com">
<title>Security proof of concept</title>
<script src="https://apis.google.com/js/platform.js" async defer></script>
</head>
<body>
	Security.
	<div class="g-signin2" data-onsuccess="onSignIn"></div>
	<div>
	<a href="#" onclick="signOut();">Sign out</a>
	<a href="#" onclick="resourceA();">Resource A</a>
	<a href="#" onclick="resourceB();">Resource B</a>
	</div>
	<div>
<!-- 	<a href="./srv/login/now">Login Server side</a> -->
	<a href="./srv/logout/now">Logout Server side</a>
	</div>
</body>
<script type="text/javascript">
		var token;
		function onSignIn(googleUser) {
			var profile = googleUser.getBasicProfile();
			console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
			console.log('Name: ' + profile.getName());
			console.log('Image URL: ' + profile.getImageUrl());
			console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
			
			token = googleUser.getAuthResponse().id_token;
			
			var postReq = new XMLHttpRequest();
			postReq.open("POST", "./srv/login/google", true);
			postReq.setRequestHeader("Accept", "application/json");
			postReq.send(token);
		}
		
		function signOut() {
		    var auth2 = gapi.auth2.getAuthInstance();
		    auth2.signOut().then(function () {
		      console.log('User signed out.');
			});
		    
		    token = null;
		}
		
		function resourceA() {
			var getA = new XMLHttpRequest();
			getA.open("GET", "./srv/boundary/resourceA", true);
			getA.setRequestHeader("token", token);
			getA.send();
		}
		
		function resourceB() {
			var getB = new XMLHttpRequest();
			getB.open("GET", "./srv/boundary/resourceB", true);
			getB.setRequestHeader("token", token);
			getB.send();
		}
	</script>
</html>